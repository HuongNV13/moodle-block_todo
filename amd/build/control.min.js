define(["jquery","core/log","core/ajax","core/templates"],function(a,b,c,d){"use strict";function e(c){b.debug("block_todo/control: initializing controls of the todo block instance "+c);var d=a('[data-region="block_todo-instance-'+c+'"]').first();if(!d.length)return void b.error("block_todo/control: wrapping region not found!");var e=new f(d);e.main()}function f(a){var b=this;b.region=a}return f.prototype.main=function(){var a=this;a.initAddFeatures()},f.prototype.initAddFeatures=function(){var a=this;a.addTextForm=a.region.find('[data-control="addform"]').first(),a.addTextInput=a.addTextForm.find("input").first(),a.addTextButton=a.addTextForm.find("button").first(),a.addTextForm.on("submit",function(b){b.preventDefault(),a.addNewTodo()}),a.addTextButton.on("click",function(){a.addTextForm.submit()})},f.prototype.addNewTodo=function(){var e=this,f=a.trim(e.addTextInput.val());return f?(e.addTextInput.prop("disabled",!0),c.call([{methodname:"block_todo_add_item",args:{todotext:f}}])[0].fail(function(c){return b.error("block_todo/control: unable to add the item"),b.debug(c),e.addTextButton.addClass("btn-danger"),e.addTextButton.html('<i class="fa fa-exclamation-circle" aria-hidden="true"></i>'),a.Deferred().reject()}).then(function(a){return d.render("block_todo/item",a).fail(function(a){b.error("block_todo/control: unable to render the new item:"+a)})}).then(function(b){return e.region.find("ul").first().prepend(b),e.addTextInput.val(""),e.addTextInput.prop("disabled",!1),a.Deferred().resolve()})):a.Deferred().resolve()},{init:e}});